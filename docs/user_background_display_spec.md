# Feature Specification: User-Facing Background Display\n\n## 1. Goal\n\nImplement the rendering of custom step backgrounds (image, solid color, gradient, YouTube video) for end-users within the onboarding wizard flow, based on the configuration set in the `StepEditor`.\n\n## 2. Research Findings\n\n*   **Primary Component:** `WizardSlideshowModal.tsx` orchestrates the user-facing wizard experience.\n    *   Fetches all necessary data, including steps with their full `config` objects (containing `presentation.backgroundType` and `presentation.backgroundValue`) via the `useUserWizardStepsQuery` hook.\n    *   Manages the current step index and navigation logic.\n    *   Renders the overall modal layout (header, footer, content area).\n*   **Step Rendering Component:** `WizardSlideshowModal.tsx` renders the content of the current step using a child component: `src/components/onboarding/steps/display/StepDisplay.tsx`.\n*   **Data Flow:** The `currentStep` object (including `currentStep.config.presentation`) is passed as a prop from `WizardSlideshowModal` to `StepDisplay`.\n*   **Target for Implementation:** The logic for applying the background style or rendering the background video must be implemented within or around the `StepDisplay` component, as it controls the direct rendering of the step content area.\n*   **Backend API:** The existing user-facing API endpoint (likely `/api/user/wizards/[wizardId]/steps`) already provides the necessary `config` data. No backend changes are required.\n\n## 3. Proposed Implementation Plan\n\n1.  **Install Dependency:** Add the `react-youtube` package for handling YouTube embeds.\n    ```bash\n    npm install react-youtube\n    # or pnpm add / yarn add\n    ```\n2.  **Modify `StepDisplay.tsx` (`src/components/onboarding/steps/display/StepDisplay.tsx`):**\n    *   **Read Config:** Access `step.config.presentation.backgroundType` and `step.config.presentation.backgroundValue` from the `step` prop.\n    *   **Identify Container:** Determine the main container `div` within `StepDisplay` (or potentially add one) that wraps the specific step content (e.g., the output of `ContentStepDisplay`, `EnsVerificationStepDisplay`, etc.) and to which the background should be applied.\n    *   **Conditional Logic:** Implement logic (e.g., a `switch` statement or helper function) based on `backgroundType`:\n        *   **`'image'`:** Apply inline style `backgroundImage: \`url(\"${value}\")\`` to the container. Add necessary CSS classes for background properties (e.g., `bg-cover`, `bg-center`).\n        *   **`'color'`:** Apply inline style `backgroundColor: value` to the container.\n        *   **`'gradient'`:** Parse the `value` (which should be a `GradientValue` object) and apply inline style `background: \`linear-gradient(${value.direction}, ${value.color1}, ${value.color2})\`` to the container.\n        *   **`'youtube'`:**\n            *   Extract the `videoId` from the `value` (URL string) using `extractYouTubeVideoId`.\n            *   Conditionally render the `YouTube` component from `react-youtube` alongside (likely positioned behind) the step content. Configure `opts` for background playback:\n                ```javascript\n                const opts = {\n                  height: '100%', // Fill container\n                  width: '100%',  // Fill container\n                  playerVars: {\n                    autoplay: 1,\n                    controls: 0,      // Hide controls\n                    mute: 1,          // Mute is usually required for autoplay\n                    loop: 1,          // Loop the video\n                    playlist: videoId, // Necessary for loop=1 to work\n                    playsinline: 1,   // iOS inline playback\n                    modestbranding: 1,\n                    showinfo: 0,      // Deprecated, but include for safety\n                    rel: 0            // Hide related videos\n                  }\n                };\n                ```\n            *   Wrap the `YouTube` component rendering in a check for `typeof window !== 'undefined'` to prevent SSR issues.\n            *   Style the container and the YouTube component using CSS (e.g., `position: relative` on container, `position: absolute`, `inset-0`, `z-index: -1` on the player wrapper) to ensure the video plays behind the actual step content.\n        *   **`null` or other:** Apply default background or no specific style.\n    *   **Content Legibility:** Ensure step content (text, buttons) remains legible over the various background types. This might involve adding a semi-transparent overlay `div` between the background and the content, or ensuring content components have their own explicit background/text colors.\n\n## 4. Potential Issues & Considerations\n\n*   **YouTube Autoplay:** Autoplay might still be blocked by some browsers/devices despite `mute: 1`. The user might see the first frame but need to interact to start playback. This is a limitation of browser policies.\n*   **Performance:** Loading background images or YouTube videos might impact step transition performance. Consider loading indicators or optimizations if needed.\n*   **Responsiveness:** Ensure backgrounds (especially images and video aspect ratios) look good on different screen sizes.\n*   **SSR:** The check `typeof window !== 'undefined'` is crucial when rendering the `YouTube` component.\n\n## 5. Next Steps (Proposal)\n\n1.  Install `react-youtube`.\n2.  Begin modifying `src/components/onboarding/steps/display/StepDisplay.tsx` to read the background config and apply basic conditional styling for `'image'`, `'color'`, and `'gradient'`. Test these first.\n3.  Implement the `'youtube'` case, including rendering the `YouTube` component and necessary wrapper styling.\n 